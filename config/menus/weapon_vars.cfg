// CC BY-SA 4-0 https://creativecommons.org/licenses/by-sa/4.0/legalcode
// Iceflower iceflower@gmx.de
// Modified by MoonPadUSer moonpaduser@mailbox.org

if (getalias hideweapvarmenucategories) [] [ hideweapvarmenucategories = 0 ]
setpersist hideweapvarmenucategories 1

VAR_TYPE_INTEGER = 0
VAR_TYPE_FLOAT   = 1
VAR_TYPE_STRING  = 2

variable_reset_button = [
    if (var_is_modified $cur_variable_name) [ 
        ui_button "^foReset" (format "%1 %2" $cur_variable_name $cur_variable_value_def)
    ] [ ui_button "^faReset" ]
]

selected_export_import_action           = 0
export_weapon_variables__all            = 0
export_weapon_variables__server         = 0
import_export_weapon_variables__filename = ""
chosenvar                               = ""
show_primary                            = 0

set_chosenvar = [
    chosenvar = $arg1
]

var_is_modified = [
    case (getvartype $arg1) $VAR_TYPE_INTEGER [ result ( !=  (getvardef  $arg1) $$arg1 )
    ]                       $VAR_TYPE_FLOAT   [ result ( !=  (getfvardef $arg1) $$arg1 )
    ]                       $VAR_TYPE_STRING  [ result ( !=s (getsvardef $arg1) $$arg1 ) ]
]

vardef = [
    var_name = (substring $arg1 (stringlen $[weap]))

    ui_button (format "^f%1%2" (? (var_is_modified $arg1) "o" "w") $arg2) (format "set_chosenvar %1" $var_name) "" "radiobox" 0xFFFFFF 0xFFFFFF -1 1 (? (=s $chosenvar $var_name) "radioboxon") $ui_color_radiobutton_box
]
vardef2 = [
    if $show_primary [  vardef [@[arg1]1] $arg2
    ] [                 vardef [@[arg1]2] $arg2 ]
]
varcategory = [
    if (! $hideweapvarmenucategories) [
        ui_list [ 
            ui_strut 2
            ui_text (format "^fB%1" $arg1)
        ]
    ]
]

weapon_variables_one = [
    [vardef  [@[weap]name]         "Name"          ]
    [vardef  [@[weap]longname]     "Long Name"     ]
    [vardef  [@[weap]colour]       "Colour"        ]
    [vardef  [@[weap]cookzoom]     "Cook Zoom"     ]
    [vardef  [@[weap]cookzoommin]  "Cook Zoom Min" ]
    [vardef  [@[weap]cookzoommax]  "Cook Zoom Max" ]
    [vardef  [@[weap]disabled]     "Disabled"      ]
    [vardef  [@[weap]delayreload]  "Delay Reload"  ]
    [vardef  [@[weap]frequency]    "Frequency"     ]
    [vardef  [@[weap]laser]        "Laser"         ]
    [vardef  [@[weap]lightpersist] "Light Persist" ]
    [vardef  [@[weap]lightradius]  "Light Radius"  ]
    [vardef  [@[weap]modes]        "Modes"         ]
    [vardef  [@[weap]muts]         "Mutators"      ]
]

weapon_variables_two = [
    [varcategory "Uncategorized"                                ]
    [vardef2  [@[weap]desc]             "Description"           ]
    [vardef2  [@[weap]aidist]           "AI Dist"               ]
    [vardef2  [@[weap]aiskew]           "AI Skew"               ]
    [vardef2  [@[weap]ammosub]          "Ammo Sub"              ]
    [vardef2  [@[weap]blend]            "Blend"                 ]
    [vardef2  [@[weap]collide]          "Collide"               ]
    [vardef2  [@[weap]extinguish]       "Extinguish"            ]
    [vardef2  [@[weap]delayattack]      "Delay Attack"          ]
    [vardef2  [@[weap]drill]            "Drill"                 ]
    [vardef2  [@[weap]elasticity]       "Elasticity"            ]
    [vardef2  [@[weap]escapedelay]      "Escape Delay"          ]
    [vardef2  [@[weap]fullauto]         "Full Auto"             ]
    [vardef2  [@[weap]grab]             "Grab"                  ]
    [vardef2  [@[weap]headmin]          "Head Min"              ]
    [vardef2  [@[weap]interacts]        "Interacts"             ]
    [vardef2  [@[weap]kickpush]         "Kick Push"             ]
    [vardef2  [@[weap]lightcol]         "Light Color"           ]
    [vardef2  [@[weap]liquidcoast]      "Liquid Coast"          ]
    [vardef2  [@[weap]obituary]         "Obituary"              ]
    [vardef2  [@[weap]obitsuicide]      "Obit Suicide"          ]
    [vardef2  [@[weap]radial]           "Radial"                ]
    [vardef2  [@[weap]radius]           "Radius"                ]
    [vardef2  [@[weap]rays]             "Rays / Bullets"        ]
    [vardef2  [@[weap]reflectivity]      "Reflectivity"           ]
    [vardef2  [@[weap]trace]            "Trace"                 ]
    [vardef2  [@[weap]weight]           "Weight"                ]
    [vardef2  [@[weap]wavepush]         "Wave Push"             ]
    [varcategory "Cook"                                         ]
    [vardef2  [@[weap]cooked]           "Cooked"                ]
    [vardef2  [@[weap]cooktime]         "Cook Time"             ]
    [varcategory "Damage"                                       ]
    [vardef2  [@[weap]damage]           "Damage"                ]
    [vardef2  [@[weap]damagehead]       "Damage Head"           ]
    [vardef2  [@[weap]damagelegs]       "Damage Legs"           ]
    [vardef2  [@[weap]damageself]       "Damage Self"           ]
    [vardef2  [@[weap]damageteam]       "Damage Team"           ]
    [vardef2  [@[weap]damagetorso]      "Damage Torso"          ]
    [vardef2  [@[weap]damagepenalty]    "Damage Penalty"        ] 
    [vardef2  [@[weap]damagewhiplash]   "Damage Whiplash"       ]
    [varcategory "Explode"                                      ]
    [vardef2  [@[weap]explcol]          "Explode Colour"        ]
    [vardef2  [@[weap]explode]          "Explode"               ]
    [varcategory "Fade"                                         ]
    [vardef2  [@[weap]fade]             "Fade"                  ]
    [vardef2  [@[weap]fadeat]           "Fade At"               ]
    [vardef2  [@[weap]fadecut]          "Fade Cut"              ]
    [vardef2  [@[weap]fadetime]         "Fade Time"             ]
    [varcategory "Fragment"                                     ]
    [vardef2  [@[weap]fragjump]         "Fragment Jump"         ]
    [vardef2  [@[weap]fragoffset]        "Fragment Offset"        ]
    [vardef2  [@[weap]fragrays]         "Fragment Rays"         ]
    [vardef2  [@[weap]fragrel]          "Fragment Rel"          ]
    [vardef2  [@[weap]fragscale]        "Fragment Scale"        ]
    [vardef2  [@[weap]fragskew]         "Fragment Skew"         ]
    [vardef2  [@[weap]fragspeed]        "Fragment Speed"        ]
    [vardef2  [@[weap]fragspeedmin]     "Fragment Speed Min"    ]
    [vardef2  [@[weap]fragspeedmax]     "Fragment Speed Max"    ]
    [vardef2  [@[weap]fragspread]       "Fragment Spread"       ]
    [vardef2  [@[weap]fragtime]         "Fragment Time"         ]
    [vardef2  [@[weap]fragtimedelay]    "Fragment Time Delay"   ]
    [vardef2  [@[weap]fragtimeiter]     "Fragment Time Iter"    ]
    [vardef2  [@[weap]fragweap]         "Fragment Weapon"       ]
    [varcategory "Guided"                                       ]
    [vardef2  [@[weap]guided]           "Guided"                ]
    [vardef2  [@[weap]guideddelay]      "Guided Delay"          ]
    [varcategory "Hit"                                          ]
    [vardef2  [@[weap]hitpush]          "Hit Push"              ]
    [vardef2  [@[weap]hitvel]           "Hit Velocity"          ]
    [varcategory "Particle"                                     ]
    [vardef2  [@[weap]partblend]        "Particle Blend"        ]
    [vardef2  [@[weap]partcol]          "Particle Color"        ]
    [vardef2  [@[weap]partfade]         "Particle Fade"         ]
    [vardef2  [@[weap]partlen]          "Particle Length"       ]
    [vardef2  [@[weap]partsize]         "Particle Size"         ]
    [vardef2  [@[weap]parttype]         "Particle Type"         ]
    [varcategory "Proximity"                                    ]
    [vardef2  [@[weap]proxdelay]        "Proximity Delay"       ]
    [vardef2  [@[weap]proxdist]         "Proximity Distance"    ]
    [vardef2  [@[weap]proxtime]         "Proximity Time"        ]
    [vardef2  [@[weap]proxtype]         "Proximity Type"        ]
    [varcategory "Residual"                                     ]
    [vardef2  [@[weap]residual]         "Residual"              ]
    [vardef2  [@[weap]residualundo]     "Residual Undo"         ]
    [varcategory "Speed"                                        ]
    [vardef2  [@[weap]speed]            "Speed"                 ]
    [vardef2  [@[weap]speeddelta]       "Speed Delta"           ]
    [vardef2  [@[weap]speedlimit]       "Speed Limit"           ]
    [vardef2  [@[weap]speedmin]         "Speed Min"             ]
    [vardef2  [@[weap]speedmax]         "Speed Max"             ]
    [varcategory "Spread"                                       ]
    [vardef2  [@[weap]spread]           "Spread"                ]
    [vardef2  [@[weap]spreadmax]        "Spread Max"            ]
    [vardef2  [@[weap]spreadmin]        "Spread Min"            ]
    [vardef2  [@[weap]spreadz]          "Spread Z"              ]
    [varcategory "Stun"                                         ]
    [vardef2  [@[weap]stun]             "Stun"                  ]
    [vardef2  [@[weap]stunfall]         "Stun Fall"             ]
    [vardef2  [@[weap]stuntime]         "Stun Time"             ]
    [varcategory "Taper"                                        ]
    [vardef2  [@[weap]taper]            "Taper"                 ]
    [vardef2  [@[weap]taperin]          "Taper In"              ]
    [vardef2  [@[weap]taperout]         "Taper Out"             ]
    [vardef2  [@[weap]tapermin]         "Taper Min"             ]
    [vardef2  [@[weap]tapermax]         "Taper Max"             ]
    [varcategory "Time"                                         ]
    [vardef2  [@[weap]time]             "Time"                  ]
    [vardef2  [@[weap]timedelay]        "Time Delay"            ]
    [vardef2  [@[weap]timeiter]         "Time Iter"             ]
    [vardef2  [@[weap]timestick]        "Time Stick"            ]
    [varcategory "Vis"                                          ]
    [vardef2  [@[weap]visfade]          "Vis Fade"              ]
    [vardef2  [@[weap]vistime]          "Vis Time"              ]
    [varcategory "Flak"                                                 ]
    [vardef2  [@[weap]flakblend]            "Flak Blend"                 ]
    [vardef2  [@[weap]flakcollide]          "Flak Collide"               ]
    [vardef2  [@[weap]flakdrill]            "Flak Drill"                 ]
    [vardef2  [@[weap]flakelasticity]       "Flak Elasticity"            ]
    [vardef2  [@[weap]flakextinguish]       "Flak Extinguish"            ]
    [vardef2  [@[weap]flakgrab]             "Flak Grab"                  ]
    [vardef2  [@[weap]flakheadmin]          "Flak Head Min"              ]
    [vardef2  [@[weap]flakinteracts]        "Flak Interacts"             ]
    [vardef2  [@[weap]flaklightcol]         "Flak Light Color"           ]
    [vardef2  [@[weap]flakliquidcoast]      "Flak Liquid Coast"          ]
    [vardef2  [@[weap]flakobituary]         "Flak Obituary"              ]
    [vardef2  [@[weap]flakobitsuicide]      "Flak Obit Suicide"          ]
    [vardef2  [@[weap]flaktimestick]        "Flak Time Stick"            ]
    [vardef2  [@[weap]flakwavepush]         "Flak Wave Push"             ]
    [vardef2  [@[weap]flakweight]           "Flak Weight"                ]
    [varcategory "Flak Damage"                                          ]
    [vardef2  [@[weap]flakdamage]           "Flak Damage"                ]
    [vardef2  [@[weap]flakdamagehead]       "Flak Damage Head"           ]
    [vardef2  [@[weap]flakdamagelegs]       "Flak Damage Legs"           ]
    [vardef2  [@[weap]flakdamageself]       "Flak Damage Self"           ]
    [vardef2  [@[weap]flakdamageteam]       "Flak Damage Team"           ]
    [vardef2  [@[weap]flakdamagetorso]      "Flak Damage Torso"          ]
    [vardef2  [@[weap]flakdamagepenalty]    "Flak Damage Penalty"        ] 
    [vardef2  [@[weap]flakdamagewhiplash]   "Flak Damage Whiplash"       ]
    [varcategory "Flak Explode"                                         ]
    [vardef2  [@[weap]flakexplcol]          "Flak Explode Colour"        ]
    [vardef2  [@[weap]flakexplode]          "Flak Explode"               ]
    [varcategory "Flak Fade"                                            ]
    [vardef2  [@[weap]flakfade]             "Flak Fade"                  ]
    [vardef2  [@[weap]flakfadeat]           "Flak Fade At"               ]
    [vardef2  [@[weap]flakfadecut]          "Flak Fade Cut"              ]
    [vardef2  [@[weap]flakfadetime]         "Flak Fade Time"             ]
    [varcategory "Flak Guided"                                          ]
    [vardef2  [@[weap]flakguided]           "Flak Guided"                ]
    [vardef2  [@[weap]flakguideddelay]      "Flak Guided Delay"          ]
    [varcategory "Flak Hit"                                             ]
    [vardef2  [@[weap]flakhitpush]          "Flak Hit Push"              ]
    [vardef2  [@[weap]flakhitvel]           "Flak Hit Velocity"          ]
    [varcategory "Flak Particle"                                        ]
    [vardef2  [@[weap]flakpartblend]        "Flak Particle Blend"        ]
    [vardef2  [@[weap]flakpartcol]          "Flak Particle Color"        ]
    [vardef2  [@[weap]flakpartfade]         "Flak Particle Fade"         ]
    [vardef2  [@[weap]flakpartlen]          "Flak Particle Length"       ]
    [vardef2  [@[weap]flakpartsize]         "Flak Particle Size"         ]
    [vardef2  [@[weap]flakparttype]         "Flak Particle Type"         ]
    [varcategory "Flak Proximity"                                       ]
    [vardef2  [@[weap]flakproxdelay]        "Flak Proximity Delay"       ]
    [vardef2  [@[weap]flakproxdist]         "Flak Proximity Distance"    ]
    [vardef2  [@[weap]flakproxtime]         "Flak Proximity Time"        ]
    [vardef2  [@[weap]flakproxtype]         "Flak Proximity Type"        ]
    [vardef2  [@[weap]flakradial]           "Flak Radial"                ]
    [vardef2  [@[weap]flakradius]           "Flak Radius"                ]
    [vardef2  [@[weap]flakreflectivity]      "Flak Reflectivity"           ]
    [varcategory "Flak Residual"                                        ]
    [vardef2  [@[weap]flakresidual]         "Flak Residual"              ]
    [vardef2  [@[weap]flakresidualundo]     "Flak Residual Undo"         ]
    [varcategory "Flak Speed"                                           ]
    [vardef2  [@[weap]flakspeeddelta]       "Flak Speed Delta"           ]
    [vardef2  [@[weap]flakspeedmin]         "Flak Speed Min"             ]
    [vardef2  [@[weap]flakspeedmax]         "Flak Speed Max"             ]
    [varcategory "Flak Stun"                                            ]
    [vardef2  [@[weap]flakstun]             "Flak Stun"                  ]
    [vardef2  [@[weap]flakstunfall]         "Flak Stun Fall"             ]
    [vardef2  [@[weap]flakstuntime]         "Flak Stun Time"             ]
    [varcategory "Flak Taper"                                           ]
    [vardef2  [@[weap]flaktaper]            "Flak Taper"                 ]
    [vardef2  [@[weap]flaktaperin]          "Flak Taper In"              ]
    [vardef2  [@[weap]flaktaperout]         "Flak Taper Out"             ]
    [vardef2  [@[weap]flaktapermin]         "Flak Taper Min"             ]
    [vardef2  [@[weap]flaktapermax]         "Flak Taper Max"             ]
    [varcategory "Flak Vis"                                             ]
    [vardef2  [@[weap]flakvisfade]          "Flak Vis Fade"              ]
    [vardef2  [@[weap]flakvistime]          "Flak Vis Time"              ]
]

variables_one_idx = 0
variables_two_idx = 0

varfld2 = [
    if $show_primary [
        varfld [@[arg1]1] $arg2
    ] [
        varfld [@[arg1]2] $arg2
    ]
]
varfld = [
    if (& (= (getvarmin $arg1) 0) (= (getvarmax $arg1) 1)) [
        ui_list [
            ui_checkbox "Toggle" $arg1
        ]
    ] [
        ui_textfield $arg1 $arg2
    ]
]

weapindex = 0

weapindexdelta = [
    weapindex = (+ $weapindex $arg1)
    if (< $weapindex 0) [ weapindex = (+ $weapindex $weapidxnum) ]
    if (>= $weapindex $weapidxnum) [ weapindex = (- $weapindex $weapidxnum) ]
]

weapcollidevars = ["traced" "hit proj" "hit owner" "impact geom" "impact plyr" "impact shot" "bounce geom" "bounce plyr" "bounce shot" "drill geom" "drill plyr" "drill shot" "stick geom" "stick plyr"]

weapmenu = [
    ui_stay_open [
        ui_list [ 
            ui_list2 [
                ui_strut 80 1
                weap = (getweap $weapindex)
                ui_list [
                    ui_image (getweap $weapindex 1) [weapindexdelta 1] 1.5 0 "textures/nothumb" "" $[@[weap]colour]
                    ui_strut 2
                    ui_list [
                        ui_font default [ ui_text [@weap (@[weapindex]/@($weapidxnum - $weapindex))] ]	// FAULT: looks 0/12 and not 1/12 or 0/11	
                        ui_list [
                            ui_button  "^fo<Prev" [weapindexdelta -1]; ui_strut 1
                            ui_button  "^fyNext>" [weapindexdelta  1]
                        ]
                    ]
                    
                    ui_spring 0.5
                    ui_bar
                    
                    ui_list [
                        ui_strut 0.25
                        ui_list [ 
                            ui_radiobutton "^fgImport" selected_export_import_action 0; ui_strut 2
                            ui_radiobutton "^fbExport" selected_export_import_action 1
                        ]  
                        
                        ui_strut 0.1
                        ui_list [
                            ui_text "Filename:"; ui_strut 0.5
                            ui_textfield import_export_weapon_variables__filename 25; ui_strut 1
                            
                            case $selected_export_import_action 0 [  // selected Import
                                ui_button "Ok" [
                                    if (!=s $import_export_weapon_variables__filename "") [
                                        if (exec $import_export_weapon_variables__filename 0 1) [
                                            import_export_weapon_variables__filename = ""
                                            echo "^fgSuccessfull"
                                        ] [ echo "^frUnsuccessfull" ]
                                    ] [ echo "^frPlease enter a valid filename " $import_export_weapon_variables__filename ]
                                ]
                            ] 1 [       // selected Export
                                ui_checkbox  "All"    export_weapon_variables__all     1 0; ui_strut 1
                                ui_checkbox  "Server" export_weapon_variables__server  1 0; ui_strut 1
                                
                                ui_button "Ok" [ 
                                    if (!=s $import_export_weapon_variables__filename "") [
                                        writeweapvars [@[weap]] $import_export_weapon_variables__filename $export_weapon_variables__all $export_weapon_variables__server
                                        import_export_weapon_variables__filename = ""
                                    ] [
                                        echo "^frPlease enter a valid filename"
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
                ui_bar
            ]
        
            ui_list [
                ui_list [
                    ui_font "little" [
                    
                        ui_center [ ui_text "General" ]
                    
                        ui_border_box 1 0 0.25 0.25 [ ui_list [
                            ui_list [ 
                                ui_strut 30 1
                                looplist i (sublist $weapon_variables_one $variables_one_idx 8) [ i ]
                            ]
                            ui_slider variables_one_idx 0 (max 0 (- (listlen $weapon_variables_one) 8)) [] 1 1
                        ] ]
                        
                        ui_strut 0.5
                        
                        ui_center [ ui_text "Action Specific" ]
                        
                        ui_center [
                            ui_radiobutton "Primary"   show_primary 1; ui_strut 1
                            ui_radiobutton "Secondary" show_primary 0
                        ]
                    
                        ui_border_box 1 0 0.25 0.25 [ ui_list [
                            ui_list [ 
                                ui_strut 30 1
                                looplist j (sublist $weapon_variables_two $variables_two_idx 16) [ j ]
                            ]
                            ui_slider variables_two_idx 0 (max 0 (- (listlen $weapon_variables_two) 16)) [] 1 1
                        ] ]
                        
                        ui_strut 0.5
                        
                        ui_checkbox "Hide Categories" hideweapvarmenucategories 0 1
                    ]
                ]
        
                ui_strut 3
        
                ui_list [ 
                    ui_strut 50 1
                    
                    
                    ui_list [
                        ui_list [ if (!=s $chosenvar "") [
                            cur_variable_name =             [@[weap]@[chosenvar]]
                            cur_variable_type =             (getvartype  $cur_variable_name)
                            cur_variable_flags =             (getvarflags  $cur_variable_name)
                            cur_variable_description =      (getvardesc  $cur_variable_name)
                            cur_variable_fields =            (getvarfields $cur_variable_name) 
                            
                            case $cur_variable_type $VAR_TYPE_INTEGER [
                                cur_variable_value_min =    (getvarmin   $cur_variable_name)
                                cur_variable_value_max =    (getvarmax   $cur_variable_name)
                                cur_variable_value_def =    (getvardef   $cur_variable_name)
                                
                            ] $VAR_TYPE_FLOAT [
                                cur_variable_value_min =    (getfvarmin  $cur_variable_name)
                                cur_variable_value_max =    (getfvarmax  $cur_variable_name)
                                cur_variable_value_def =    (getfvardef  $cur_variable_name)
                                
                            ] $VAR_TYPE_STRING [
                                cur_variable_value_def =    (getsvardef  $cur_variable_name)
                                
                            ] () [                              // everything else
                                cur_variable_value_def =    (getvardef   $cur_variable_name)
                            ]
                            
                            ui_strut 1
                            
                            ui_list [
                                ui_list [
                                    ui_strut 8
                                ]
                            
                                ui_list [ 
                                    case $cur_variable_type $VAR_TYPE_INTEGER [
                                    
                                        if (& (= $cur_variable_value_min 0) (= $cur_variable_value_max 1)) [
                                            ui_text         "^faVariable Type: ^fwBoolean"
                                            ui_text (format "^faVariable Name: ^fw%1" $cur_variable_name)
                                            ui_strut 0.5
                                            
                                            ui_checkbox "Toggle" $cur_variable_name 1 0
                                        ] [
                                            if (& 256 $cur_variable_flags) [
                                                ui_text         "^faVariable Type: ^fwHex Color"
                                                ui_text (format "^faVariable Name: ^fw%1" $cur_variable_name)
                                                ui_strut 0.5
                                        
                                                ui_list [ ui_body [ ui_list [
                                                    ui_hex_preview $$cur_variable_name (hexcolour $$cur_variable_name)
                                                ] ] [ pick_color $cur_variable_name ] ]
                                                variable_reset_button
                                            ] [
                                                ui_text         "^faVariable Type: ^fwInteger"
                                                ui_text (format "^faVariable Name: ^fw%1" $cur_variable_name)
                                                ui_strut 0.5
                                                
                                                ui_list [
                                                    ui_text (format "^fbMin: ^fw%1" $cur_variable_value_min); ui_strut 1
                                                    ui_text (format "^frMax: ^fw%1" $cur_variable_value_max)
                                                ]
                                                ui_text (format "^fgDefault: ^fw%1" $cur_variable_value_def)
                                                ui_strut 1
                                                
                                                ui_list [
                                                    ui_textfield $cur_variable_name; ui_strut 1
                                                    variable_reset_button
                                                ]
                                            ]
                                        ]
                                    ] $VAR_TYPE_FLOAT [ 
                                    
                                        ui_text         "^faVariable Type: ^fwFloat"
                                        ui_text (format "^faVariable Name: ^fw%1" $cur_variable_name)
                                        ui_strut 0.5
                                        
                                        ui_list [
                                            ui_text (format "^fbMin: ^fw%1" $cur_variable_value_min); ui_strut 1
                                            ui_text (format "^frMax: ^fw%1" $cur_variable_value_max)
                                        ]
                                        ui_text (format "^fgDefault: ^fw%1" $cur_variable_value_def)
                                        ui_strut 1
                                        
                                        ui_list [
                                            ui_textfield $cur_variable_name; ui_strut 1
                                            variable_reset_button
                                        ]
                                        
                                    ] $VAR_TYPE_STRING [
                                    
                                        ui_text         "^faVariable Type: ^fwString"
                                        ui_text (format "^faVariable Name: ^fw%1" $cur_variable_name)
                                        ui_strut 0.5
                                        
                                        ui_text (format "^fgDefault: ^fw%1" $cur_variable_value_def) "" -1 -1 1000
                                        ui_strut 1
                                        
                                        ui_textfield $cur_variable_name 50
                                        ui_strut 1
                                        
                                        variable_reset_button
                                        
                                    ] () [ 
                                        ui_text "^faVariable Type: ^fw???"
                                    ]
                                ]
                            ]
                            
                            ui_strut 0 1
                            
                            ui_font "emphasis" [ ui_text "Info:" ]
                            ui_text $cur_variable_description "" -1 -1 1200
                            
                            scurfmax = (- (<< 1 $cur_variable_fields) 1)
                            if (& (= $cur_variable_type $VAR_TYPE_INTEGER) (> $cur_variable_fields 1)) [
                                if (!= $scurfmax $cur_variable_value_max) [
                                    ui_text (format "^fyUsage description of %1 implies a max value of %2, but it should be %3." $cur_variable_name $scurfmax $cur_variable_value_max)
                                ]
                                ui_list [
                                    ui_strut 5
                                    ui_list [
                                        loop i $cur_variable_fields [
                                            ui_font "little" [ ui_bitfield (getvarfields $cur_variable_name $i) $cur_variable_name (<< 1 $i) ]
                                        ]
                                    ]
                                ]
                            ]
                        ] ]
                    ]
                ]
            ]
            
        ]
        
        
        
        //ui_strut 3
        //ui_list [
        //    loop n 2 [
        //        ui_list [
        //            push n (at "collide flakcollide" $n) [
        //                ui_list [
        //                    vardef2 [@[weap]@n] (format "^fw%1" (at [collision: "flak collision:"] @@n))
        //                    looplist a $weapcollidevars [ui_text $a]
        //                ]
        //                ui_strut 2
        //                ui_list [
        //                    ui_text "^fwpri^fa/^fwalt"
        //                    loop b (listlen $weapcollidevars) [
        //                        varbit2 [@[weap]@n] (<< 1 $b)
        //                    ]
        //                ]
        //            ]
        //        ]
        //        if (= $n 0) [ui_strut 2]
        //    ]
        //]
    ]
]
newgui weap_vars [
    ui_header "Weapons"
    ui_list [ weapmenu ]
]

bind F7 [ showgui weap_vars ]
 
